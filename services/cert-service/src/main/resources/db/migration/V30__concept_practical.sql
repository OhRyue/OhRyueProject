SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS = 0;

USE certpilot_cert;

-- =========================================
-- 실기 P.1 개념 (업무 시나리오 해석 + 업무 및 데이터 요구 도출)
--  - topic_id = 31101 (P.1.1), 31102 (P.1.2)
-- =========================================

SET @tp_req_scenario := 31101; -- P.1.1 업무 시나리오 해석
SET @tp_req_data     := 31102; -- P.1.2 업무 및 데이터 요구 도출

-- ============================
-- P.1.1 업무 시나리오 해석
-- topic_id = 31101
-- ============================

INSERT INTO concept (topic_id, sections_json)
SELECT @tp_req_scenario,
       JSON_OBJECT(
         'sections', JSON_ARRAY(

           /* -------------------------------------
              P.1.1.1 업무 시나리오 읽는 순서
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 1,
             'subCode', 'P.1.1.1',
             'title', '업무 시나리오를 읽는 순서와 관점',
             'importance', 5,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','실기에서 시나리오를 보는 기본 관점'),
               JSON_OBJECT(
                 'type','paragraph',
                 'text',
                 '실기 시험에서는 주문 처리, 게시글 등록, 수강 신청과 같이 실제 업무 흐름을 서술형 시나리오로 제시합니다. 시나리오를 한 번에 이해하려 하기보다, 역할, 행위, 데이터라는 세 가지 관점으로 나누어 읽는 것이 중요합니다.'
               ),

               JSON_OBJECT(
                 'type','table',
                 'caption','업무 시나리오 해석의 3가지 관점',
                 'headers',JSON_ARRAY('관점','질문','예시'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY('역할(Actor)','누가 이 일을 하고 있는가?','고객, 관리자, 강사, 점주'),
                   JSON_ARRAY('행위(Action)','어떤 행동이 일어나는가?','주문한다, 승인한다, 취소한다'),
                   JSON_ARRAY('데이터(Data)','어떤 정보를 기록·조회해야 하는가?','주문번호, 상품명, 수량, 결제금액')
                 )
               ),

               JSON_OBJECT('type','heading','text','시나리오 해석 4단계'),
               JSON_OBJECT(
                 'type','list',
                 'items',JSON_ARRAY(
                   '1단계: 시나리오를 처음부터 끝까지 빠르게 읽어 전체 흐름을 파악한다.',
                   '2단계: 다시 읽으면서 행위자(Actor)를 동그라미, 핵심 이벤트를 밑줄로 표시한다.',
                   '3단계: 데이터로 보이는 단어(고객번호, 주문일자 등)에 네모를 치며 정리한다.',
                   '4단계: 정리한 역할·행위·데이터를 기준으로 유스케이스와 ERD로 연결한다.'
                 )
               )
             )
           ),

           /* -------------------------------------
              P.1.1.2 예시 시나리오 해석 연습
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 2,
             'subCode', 'P.1.1.2',
             'title', '예시 시나리오로 보는 해석 연습',
             'importance', 4,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','간단한 주문 처리 시나리오 예시'),
               JSON_OBJECT(
                 'type','paragraph',
                 'text',
                 '다음은 시험에서 자주 등장하는 주문 처리 유형의 축약된 시나리오입니다. 실제 시험 시에는 이와 유사한 문장을 보고 ERD, 테이블, 업무 흐름도를 작성하게 됩니다.'
               ),

               JSON_OBJECT(
                 'type','table',
                 'caption','예시 시나리오와 해석 포인트',
                 'headers',JSON_ARRAY('시나리오 문장','해석 포인트'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY(
                     '고객이 온라인 쇼핑몰에서 상품을 선택하여 장바구니에 담는다.',
                     'Actor: 고객 / 행위: 상품 선택, 장바구니 담기 / 데이터: 고객, 상품, 장바구니'
                   ),
                   JSON_ARRAY(
                     '고객이 결제를 완료하면 주문이 생성되고, 재고 수량이 차감된다.',
                     '이벤트: 결제 완료 / 결과: 주문 생성, 재고 차감 / 데이터: 주문, 재고'
                   ),
                   JSON_ARRAY(
                     '관리자는 배송 상태를 출고 대기, 배송 중, 배송 완료로 변경할 수 있다.',
                     'Actor: 관리자 / 상태값: 출고 대기, 배송 중, 배송 완료 / 데이터: 주문 상태 이력'
                   )
                 )
               ),

               JSON_OBJECT('type','heading','text','시나리오에서 바로 ERD로 연결하기 위한 질문'),
               JSON_OBJECT(
                 'type','list',
                 'items',JSON_ARRAY(
                   '이 시나리오에 등장하는 고유한 실체(엔터티)는 무엇인가? (고객, 상품, 주문, 장바구니 등)',
                   '각 실체를 구분해 주는 식별자는 무엇인가? (고객ID, 주문번호 등)',
                   '엔터티 간 관계는 어떻게 연결되는가? (고객 1명 대 주문 여러 건, 주문 1건 대 상품 여러 개 등)',
                   '상태가 바뀌는 대상은 무엇이며, 상태값은 어떻게 관리할 것인가? (주문 상태 이력 테이블 등)'
                 )
               )
             )
           ),

           /* -------------------------------------
              P.1.1.3 시험에서 자주 나오는 키워드 박스
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 3,
             'subCode', 'P.1.1.3',
             'title', '시험에서 자주 보이는 업무 키워드와 해석 팁',
             'importance', 3,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','자주 등장하는 업무 키워드'),
               JSON_OBJECT(
                 'type','table',
                 'caption','업무 키워드 요약 박스',
                 'headers',JSON_ARRAY('키워드','의미','모델링 시 포인트'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY('승인, 반려','어떤 요청을 검토한 뒤 결과를 결정하는 과정','승인 내역, 승인자, 승인일시를 별도 테이블로 둘지 여부 검토'),
                   JSON_ARRAY('상태 변경','처리 흐름에 따라 상태값이 여러 번 바뀌는 경우','상태 이력 테이블을 별도로 두어 변경 이력을 관리할지 검토'),
                   JSON_ARRAY('포인트 적립','사용자 활동에 따라 포인트가 쌓이는 구조','포인트 적립/차감 이력 테이블, 잔여 포인트 컬럼 설계'),
                   JSON_ARRAY('예약, 취소','미래 시점의 작업 예약과 취소 기능','예약 상태, 예약일시, 취소 사유 등의 컬럼 정의')
                 )
               ),

               JSON_OBJECT(
                 'type','paragraph',
                 'text',
                 '실기에서는 키워드를 보고 어떤 엔터티와 속성이 추가로 필요해지는지 떠올릴 수 있어야 합니다. 시나리오 문장에서 이런 단어들을 발견하면, 바로 엔터티와 속성 후보를 메모해 두는 습관이 중요합니다.'
               )
             )
           )

         )
       )
ON DUPLICATE KEY UPDATE
  sections_json = VALUES(sections_json);

-- ============================
-- P.1.2 업무 및 데이터 요구 도출
-- topic_id = 31102
-- ============================

INSERT INTO concept (topic_id, sections_json)
SELECT @tp_req_data,
       JSON_OBJECT(
         'sections', JSON_ARRAY(

           /* -------------------------------------
              P.1.2.1 업무 요구 vs 데이터 요구 정리
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 1,
             'subCode', 'P.1.2.1',
             'title', '업무 요구와 데이터 요구의 차이',
             'importance', 5,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','업무 요구와 데이터 요구를 구분해야 하는 이유'),
               JSON_OBJECT(
                 'type','paragraph',
                 'text',
                 '실무와 시험 모두에서 요구사항 문서는 보통 업무 관점과 데이터 관점이 섞여 있습니다. 업무 요구는 무엇을 하고 싶은지에 대한 설명이고, 데이터 요구는 이를 위해 어떤 정보를 저장하고 조회해야 하는지에 대한 설명입니다. 두 가지를 구분해 두어야 이후 설계 단계에서 헷갈리지 않습니다.'
               ),

               JSON_OBJECT(
                 'type','table',
                 'caption','업무 요구와 데이터 요구 비교',
                 'headers',JSON_ARRAY('구분','설명','예시'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY(
                     '업무 요구',
                     '업무 절차와 규칙에 관한 요구. 사용자가 하고 싶은 일에 대한 설명.',
                     '배송 지연 시 고객에게 알림을 발송해야 한다.'
                   ),
                   JSON_ARRAY(
                     '데이터 요구',
                     '업무를 수행하기 위해 저장·조회해야 하는 데이터에 대한 요구.',
                     '주문번호, 배송예정일, 고객연락처, 알림 발송일시를 저장해야 한다.'
                   )
                 )
               ),

               JSON_OBJECT('type','heading','text','요구 정의서에서 자주 등장하는 표현'),
               JSON_OBJECT(
                 'type','list',
                 'items',JSON_ARRAY(
                   '업무 요구 표현 예시: 처리한다, 발송한다, 승인한다, 조회한다, 집계한다.',
                   '데이터 요구 표현 예시: 정보를 보관한다, 필수로 입력해야 한다, 식별자를 부여한다.',
                   '시험에서 “어떤 항목을 추가로 저장해야 하는가”라는 질문은 대부분 데이터 요구에 해당한다.'
                 )
               )
             )
           ),

           /* -------------------------------------
              P.1.2.2 명세서 문장에서 요구 뽑아내기
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 2,
             'subCode', 'P.1.2.2',
             'title', '요구사항 명세서에서 업무/데이터 요구 도출하기',
             'importance', 4,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','예시 문장을 기준으로 분리 연습'),
               JSON_OBJECT(
                 'type','table',
                 'caption','요구사항 문장 분석 예시',
                 'headers',JSON_ARRAY('요구사항 문장','업무 요구','데이터 요구'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY(
                     '관리자는 월별 매출 통계를 조회할 수 있어야 한다.',
                     '월별 매출 통계를 조회할 수 있어야 한다.',
                     '매출일자, 매출금액, 매출채널, 월별 합계 금액을 저장·집계해야 한다.'
                   ),
                   JSON_ARRAY(
                     '회원 탈퇴 시 3년간 거래 이력을 보관해야 한다.',
                     '회원 탈퇴 처리 후에도 거래 이력을 보관해야 한다.',
                     '회원ID, 거래ID, 거래일자, 금액, 탈퇴일자 등을 3년간 보관하는 정책이 필요하다.'
                   ),
                   JSON_ARRAY(
                     '포인트는 주문 금액의 1%를 적립하며, 만료일을 지정해야 한다.',
                     '주문 금액에 따라 포인트를 적립하고 만료 처리해야 한다.',
                     '적립 포인트 금액, 적립일시, 만료일, 사용 여부를 저장해야 한다.'
                   )
                 )
               ),

               JSON_OBJECT('type','heading','text','시험에서 요구 도출 문제를 만났을 때의 접근 순서'),
               JSON_OBJECT(
                 'type','list',
                 'items',JSON_ARRAY(
                   '1단계: 요구사항 문장에서 “해야 한다”에 해당하는 부분을 먼저 찾는다.',
                   '2단계: 그 문장이 설명하는 업무 흐름을 한 줄로 정리한다. (업무 요구)',
                   '3단계: 업무를 수행하려면 어떤 정보가 반드시 필요할지 역으로 생각한다. (데이터 요구)',
                   '4단계: 필수로 저장해야 할 컬럼과, 파생·집계로 계산 가능한 값들을 구분한다.'
                 )
               )
             )
           ),

           /* -------------------------------------
              P.1.2.3 누락/모순 체크를 위한 간단 체크리스트
              ------------------------------------- */
           JSON_OBJECT(
             'orderNo', 3,
             'subCode', 'P.1.2.3',
             'title', '요구사항 누락·모순을 찾기 위한 체크리스트',
             'importance', 3,
             'blocks', JSON_ARRAY(

               JSON_OBJECT('type','heading','text','요구사항 품질 관점에서 자주 묻는 항목'),
               JSON_OBJECT(
                 'type','table',
                 'caption','요구사항 품질 체크 박스',
                 'headers',JSON_ARRAY('항목','질문','예시'),
                 'rows',JSON_ARRAY(
                   JSON_ARRAY(
                     '완전성',
                     '중간 단계가 생략된 것은 없는가?',
                     '주문 접수 → 결제 → 배송 준비 → 배송 로직 중 하나가 설명에서 빠져 있지는 않은지 확인.'
                   ),
                   JSON_ARRAY(
                     '일관성',
                     '서로 다른 문장끼리 상충되는 내용은 없는가?',
                     '한 문장에서는 배송비 무료라고 하고, 다른 문장에서는 조건부 배송비를 설명하는 경우.'
                   ),
                   JSON_ARRAY(
                     '추적성',
                     '업무 요구와 데이터 요구가 서로 연결되어 있는가?',
                     '“알림을 발송해야 한다”는 업무 요구에 대해 실제로 “알림 발송 로그” 데이터 요구가 정의되어 있는지 확인.'
                   )
                 )
               ),

               JSON_OBJECT('type','heading','text','실기에서 자주 묻는 요구사항 관련 키워드'),
               JSON_OBJECT(
                 'type','list',
                 'items',JSON_ARRAY(
                   '필수 입력: NULL 을 허용할지 여부, 제약조건 설계와 직접 연결된다.',
                   '중복 방지: 유일성 제약, 후보키·기본키 선정과 연결된다.',
                   '보안/권한: 어떤 역할이 어떤 데이터에 접근 가능한지, 권한 테이블 설계로 이어진다.'
                 )
               )
             )
           )

         )
       )
ON DUPLICATE KEY UPDATE
  sections_json = VALUES(sections_json);

SET FOREIGN_KEY_CHECKS = 1;
